
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../01-introduction-to-microservices/">
      
      
        <link rel="next" href="../lab-1/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Разбиение монолита на микросервисы - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Разбиение монолита на микросервисы
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../01-introduction-to-microservices/" class="md-tabs__link">
        
  
  
    
  
  Введение в микросервисную архитектуру

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Разбиение монолита на микросервисы

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../lab-1/" class="md-tabs__link">
        
  
  
    
  
  Практическое задание №1. Взаимодействие микросервисов через REST API

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../03-interaction-of-microservices/" class="md-tabs__link">
        
  
  
    
  
  Взаимодействие микросервисов

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../lab-2/" class="md-tabs__link">
        
  
  
    
  
  Практическое задание №2. Реализация API Gateway и Асинхронного Взаимодействия

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../04-data-management/" class="md-tabs__link">
        
  
  
    
  
  Управление данными в микросервисной архитектуре

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../05-security/index.md" class="md-tabs__link">
        
  
  
    
  
  Безопасность микросервисов

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../06-deployment-and-management/index.md" class="md-tabs__link">
        
  
  
    
  
  Развертывание и управление микросервисами

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../07-monitoring-and-logging/index.md" class="md-tabs__link">
        
  
  
    
  
  Мониторинг и логирование микросервисов

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../08-antipatterns/index.md" class="md-tabs__link">
        
  
  
    
  
  Антипаттерны микросервисов и способы их решения

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../final-project/index.md" class="md-tabs__link">
        
  
  
    
  
  Финальный проект

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Главная
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduction-to-microservices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Введение в микросервисную архитектуру
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Разбиение монолита на микросервисы
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Разбиение монолита на микросервисы
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      План
    </span>
  </a>
  
    <nav class="md-nav" aria-label="План">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-" class="md-nav__link">
    <span class="md-ellipsis">
      1. Принципы декомпозиции сервисов (по бизнес-контексту, по функциональности, по данным)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. Транзакции и консистентность данных в распределенной системе
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. Проблемы разбиения (чрезмерная фрагментация, сложность взаимодействия)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Принципы декомпозиции сервисов при переходе от монолита
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Принципы декомпозиции сервисов при переходе от монолита">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Введение: Проблема монолита и необходимость декомпозиции
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-business-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      1. Декомпозиция по бизнес-возможностям (Business Capabilities)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ddd" class="md-nav__link">
    <span class="md-ellipsis">
      2. Декомпозиция по функциональности (или поддоменам DDD)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-data" class="md-nav__link">
    <span class="md-ellipsis">
      3. Декомпозиция по данным (Data)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Сравнение и Рекомендации
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Транзакции и консистентность данных в распределенной системе
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Транзакции и консистентность данных в распределенной системе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acid" class="md-nav__link">
    <span class="md-ellipsis">
      Введение: От ACID в монолите к вызовам распределенных систем
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2pc" class="md-nav__link">
    <span class="md-ellipsis">
      Проблема традиционных распределенных транзакций (2PC)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventual-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      Итоговая согласованность (Eventual Consistency)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saga" class="md-nav__link">
    <span class="md-ellipsis">
      Паттерн Saga
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Другие важные паттерны и концепции
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Вызовы и сложности
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Проблемы разбиения монолита на микросервисы: Чрезмерная фрагментация и Сложность взаимодействия
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Проблемы разбиения монолита на микросервисы: Чрезмерная фрагментация и Сложность взаимодействия">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. Чрезмерная фрагментация (Проблема "Наносервисов")
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. Сложность взаимодействия между сервисами
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      Стратегии смягчения проблем
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      Заключение
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Практическое задание №1. Взаимодействие микросервисов через REST API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-interaction-of-microservices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Взаимодействие микросервисов
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Практическое задание №2. Реализация API Gateway и Асинхронного Взаимодействия
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-data-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Управление данными в микросервисной архитектуре
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-security/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Безопасность микросервисов
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-deployment-and-management/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Развертывание и управление микросервисами
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-monitoring-and-logging/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Мониторинг и логирование микросервисов
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-antipatterns/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Антипаттерны микросервисов и способы их решения
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../final-project/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Финальный проект
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      План
    </span>
  </a>
  
    <nav class="md-nav" aria-label="План">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-" class="md-nav__link">
    <span class="md-ellipsis">
      1. Принципы декомпозиции сервисов (по бизнес-контексту, по функциональности, по данным)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. Транзакции и консистентность данных в распределенной системе
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. Проблемы разбиения (чрезмерная фрагментация, сложность взаимодействия)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Принципы декомпозиции сервисов при переходе от монолита
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Принципы декомпозиции сервисов при переходе от монолита">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Введение: Проблема монолита и необходимость декомпозиции
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-business-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      1. Декомпозиция по бизнес-возможностям (Business Capabilities)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ddd" class="md-nav__link">
    <span class="md-ellipsis">
      2. Декомпозиция по функциональности (или поддоменам DDD)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-data" class="md-nav__link">
    <span class="md-ellipsis">
      3. Декомпозиция по данным (Data)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Сравнение и Рекомендации
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Транзакции и консистентность данных в распределенной системе
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Транзакции и консистентность данных в распределенной системе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acid" class="md-nav__link">
    <span class="md-ellipsis">
      Введение: От ACID в монолите к вызовам распределенных систем
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2pc" class="md-nav__link">
    <span class="md-ellipsis">
      Проблема традиционных распределенных транзакций (2PC)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventual-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      Итоговая согласованность (Eventual Consistency)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saga" class="md-nav__link">
    <span class="md-ellipsis">
      Паттерн Saga
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Другие важные паттерны и концепции
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Вызовы и сложности
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Проблемы разбиения монолита на микросервисы: Чрезмерная фрагментация и Сложность взаимодействия
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Проблемы разбиения монолита на микросервисы: Чрезмерная фрагментация и Сложность взаимодействия">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. Чрезмерная фрагментация (Проблема "Наносервисов")
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. Сложность взаимодействия между сервисами
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      Стратегии смягчения проблем
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      Заключение
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="_1">Разбиение монолита на микросервисы</h1>
<h2 id="_2">План</h2>
<h4 id="1-"><a href="#_3">1. Принципы декомпозиции сервисов (по бизнес-контексту, по функциональности, по данным)</a></h4>
<h4 id="2"><a href="#_6">2. Транзакции и консистентность данных в распределенной системе</a></h4>
<h4 id="3"><a href="#_9">3. Проблемы разбиения (чрезмерная фрагментация, сложность взаимодействия)</a></h4>
<h2 id="_3">Принципы декомпозиции сервисов при переходе от монолита</h2>
<p>Сегодня мы рассмотрим одну из ключевых тем в современной архитектуре программного обеспечения – принципы декомпозиции сервисов при переходе от монолитной архитектуры к микросервисной. Выбор правильной стратегии декомпозиции является критически важным для успеха всего проекта, так как он определяет границы будущих сервисов, их взаимодействие и, в конечном итоге, управляемость и масштабируемость системы.</p>
<h3 id="_4">Введение: Проблема монолита и необходимость декомпозиции</h3>
<p>Монолитная архитектура, где все компоненты приложения тесно связаны и развертываются как единое целое, имеет свои преимущества на ранних стадиях разработки. Однако с ростом сложности и масштаба системы проявляются существенные недостатки:</p>
<ol>
<li><strong>Сложность внесения изменений:</strong> Изменение в одной части системы может потребовать пересборки и переразвертывания всего приложения, что увеличивает риски и замедляет цикл разработки.</li>
<li><strong>Технологическая связанность:</strong> Весь монолит обычно построен на одном технологическом стеке, что затрудняет внедрение новых технологий или языков программирования для отдельных частей системы.</li>
<li><strong>Проблемы масштабирования:</strong> Масштабировать приходится все приложение целиком, даже если нагрузка возрастает только на одну его функцию.</li>
<li><strong>Надежность:</strong> Сбой в одном компоненте может привести к отказу всего приложения.</li>
<li><strong>Сложность понимания и развития:</strong> Большие кодовые базы становятся трудными для понимания новыми разработчиками, замедляя их адаптацию и продуктивность.</li>
</ol>
<p>Микросервисная архитектура предлагает решение этих проблем путем разбиения приложения на набор небольших, независимо развертываемых сервисов, каждый из которых отвечает за определенную часть функциональности. Однако главный вопрос – <strong>как</strong> правильно определить границы этих сервисов? Неудачная декомпозиция может привести к созданию "распределенного монолита", унаследовав проблемы старой архитектуры и добавив новые, связанные с распределенными системами.</p>
<p>Рассмотрим три основных принципа декомпозиции:</p>
<ol>
<li><strong>По бизнес-возможностям (Business Capabilities)</strong></li>
<li><strong>По функциональности (или поддоменам в терминах DDD)</strong></li>
<li><strong>По данным (Data)</strong></li>
</ol>
<h3 id="1-business-capabilities">1. Декомпозиция по бизнес-возможностям (Business Capabilities)</h3>
<p>Это, пожалуй, наиболее рекомендуемый и стратегически верный подход.</p>
<ul>
<li><strong>Определение:</strong> Бизнес-возможность – это то, <strong>что</strong> бизнес делает для достижения своих целей (например, "Управление заказами", "Управление каталогом товаров", "Обработка платежей", "Управление пользователями"). Она описывает высокоуровневую функцию организации.</li>
<li><strong>Принцип:</strong> Сервис проектируется таким образом, чтобы инкапсулировать реализацию одной конкретной бизнес-возможности. Границы сервиса совпадают с границами этой возможности.</li>
<li><strong>Как применять:</strong><ul>
<li>Проанализируйте бизнес-процессы и цели организации.</li>
<li>Идентифицируйте ключевые возможности, которые необходимы для функционирования бизнеса.</li>
<li>Сгруппируйте связанные функции и данные вокруг этих возможностей.</li>
<li>Каждая такая группа становится кандидатом в микросервис.</li>
</ul>
</li>
<li><strong>Преимущества:</strong><ul>
<li><strong>Стабильность границ:</strong> Бизнес-возможности меняются реже, чем конкретные процессы или технологии. Это приводит к более стабильной архитектуре в долгосрочной перспективе.</li>
<li><strong>Автономность команд:</strong> Позволяет организовать команды вокруг бизнес-возможностей (согласно закону Конвея), что способствует лучшей координации и ответственности.</li>
<li><strong>Бизнес-ориентированность:</strong> Архитектура напрямую отражает структуру и цели бизнеса, что облегчает коммуникацию между разработчиками и представителями бизнеса.</li>
<li><strong>Высокая связность (Cohesion):</strong> Компоненты внутри сервиса тесно связаны логически и функционально.</li>
<li><strong>Низкое зацепление (Coupling):</strong> Взаимодействие между сервисами происходит на уровне бизнес-процессов, что минимизирует техническую зависимость.</li>
</ul>
</li>
<li>
<p><strong>Недостатки / Сложности:</strong></p>
<ul>
<li>Требует глубокого понимания бизнес-домена.</li>
<li>Идентификация правильных бизнес-возможностей может быть нетривиальной задачей, особенно в сложных или быстро меняющихся доменах.</li>
<li>Может потребовать реорганизации данных, если они были спроектированы без учета бизнес-возможностей в монолите.</li>
</ul>
</li>
<li>
<p><strong>Пример:</strong> В системе электронной коммерции бизнес-возможностями могут быть:</p>
<ul>
<li><code>Сервис Каталога Товаров</code> (управление информацией о товарах)</li>
<li><code>Сервис Управления Заказами</code> (создание, обработка, отслеживание заказов)</li>
<li><code>Сервис Управления Клиентами</code> (регистрация, профили, история)</li>
<li><code>Сервис Платежей</code> (обработка транзакций)</li>
<li><code>Сервис Инвентаризации</code> (учет остатков на складе)</li>
</ul>
</li>
</ul>
<h3 id="2-ddd">2. Декомпозиция по функциональности (или поддоменам DDD)</h3>
<p>Этот подход тесно связан с предыдущим, но может рассматриваться как его уточнение или альтернатива, особенно при использовании методологии Domain-Driven Design (DDD).</p>
<ul>
<li><strong>Определение:</strong> Сервисы выделяются на основе логически сгруппированной функциональности или поддоменов предметной области. Поддомен (Subdomain) в DDD – это часть общей предметной области приложения. Ограниченный Контекст (Bounded Context) – это явная граница, внутри которой применяется определенная модель домена. Часто граница сервиса совпадает с границей Ограниченного Контекста.</li>
<li><strong>Принцип:</strong> Группировка связанных функций, классов, модулей монолита в отдельные сервисы. Часто это соответствует пользовательским сценариям или наборам операций.</li>
<li><strong>Как применять:</strong><ul>
<li>Проанализируйте существующий код монолита или требования к системе.</li>
<li>Идентифицируйте группы функций, которые часто используются вместе или работают с общими данными.</li>
<li>Примените практики DDD (Event Storming, Context Mapping) для выявления поддоменов и ограниченных контекстов.</li>
<li>Определите границы сервисов вокруг этих функциональных блоков или контекстов.</li>
</ul>
</li>
<li><strong>Преимущества:</strong><ul>
<li><strong>Логическая группировка:</strong> Облегчает понимание ответственности каждого сервиса разработчиками.</li>
<li><strong>Потенциал для переиспользования:</strong> Функциональные сервисы (например, "Сервис Уведомлений", "Сервис Поиска") могут быть использованы другими частями системы.</li>
<li><strong>Хорошо работает с DDD:</strong> Является естественным следствием применения DDD для моделирования системы.</li>
</ul>
</li>
<li>
<p><strong>Недостатки / Сложности:</strong></p>
<ul>
<li><strong>Риск создания "технических" сервисов:</strong> Если фокусироваться только на функциональности без учета бизнес-контекста, можно создать сервисы, которые не несут бизнес-ценности сами по себе (например, "Сервис работы со строками").</li>
<li><strong>Нечеткие границы:</strong> Границы функциональности могут быть менее стабильны, чем границы бизнес-возможностей.</li>
<li><strong>Сложность определения правильного уровня гранулярности:</strong> Слишком мелкие сервисы приведут к излишней сложности взаимодействия, слишком крупные – к "микро-монолитам".</li>
<li>Может привести к сильному зацеплению, если функциональные блоки тесно связаны данными или бизнес-логикой, которая оказалась разделенной.</li>
</ul>
</li>
<li>
<p><strong>Пример (дополняя предыдущий):</strong></p>
<ul>
<li>В дополнение к сервисам по бизнес-возможностям, могут появиться более технические или узкофункциональные сервисы:<ul>
<li><code>Сервис Аутентификации и Авторизации</code></li>
<li><code>Сервис Уведомлений</code> (отправка email, SMS)</li>
<li><code>Сервис Поиска</code> (индексация и поиск по товарам, заказам и т.д.)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-data">3. Декомпозиция по данным (Data)</h3>
<p>Этот подход фокусируется на данных и их жизненном цикле.</p>
<ul>
<li><strong>Определение:</strong> Сервисы проектируются вокруг определенных сущностей данных или агрегатов (в терминах DDD). Каждый сервис становится "владельцем" своего набора данных и единственным, кто может напрямую их изменять.</li>
<li><strong>Принцип:</strong> Определите ключевые сущности в вашей системе (например, <code>Клиент</code>, <code>Товар</code>, <code>Заказ</code>). Создайте сервис для управления каждой такой сущностью или связанной группой сущностей (агрегатом).</li>
<li><strong>Как применять:</strong><ul>
<li>Проанализируйте схему данных монолита или модель предметной области.</li>
<li>Идентифицируйте ключевые таблицы или сущности.</li>
<li>Сгруппируйте таблицы/сущности, которые тесно связаны и часто изменяются вместе.</li>
<li>Создайте сервис для каждой такой группы, который будет предоставлять API для доступа и модификации этих данных.</li>
</ul>
</li>
<li><strong>Преимущества:</strong><ul>
<li><strong>Четкое владение данными:</strong> Устраняет проблемы с конкурентным доступом и модификацией данных из разных частей системы.</li>
<li><strong>Возможность выбора оптимального хранилища:</strong> Каждый сервис может использовать технологию хранения данных (SQL, NoSQL, графовая БД), наиболее подходящую для его задач.</li>
</ul>
</li>
<li>
<p><strong>Недостатки / Сложности:</strong></p>
<ul>
<li><strong>Высокий риск сильного зацепления (High Coupling):</strong> Бизнес-транзакции часто затрагивают несколько сущностей данных. Если каждая сущность находится в своем сервисе, выполнение одной бизнес-операции потребует координации между множеством сервисов (например, через распределенные транзакции или саги), что значительно усложняет систему.</li>
<li><strong>Проблемы с консистентностью данных:</strong> Обеспечение согласованности данных между сервисами становится сложной задачей.</li>
<li><strong>Сложность запросов:</strong> Получение данных, требующих объединения информации из разных сервисов (JOIN в мире SQL), становится очень неэффективным или требует создания специализированных сервисов-агрегаторов или использования паттернов вроде CQRS.</li>
<li><strong>Часто приводит к созданию CRUD-сервисов:</strong> Такие сервисы просто предоставляют API для базовых операций с данными и не инкапсулируют бизнес-логику, что противоречит идее умных эндпоинтов и глупых пайпов (smart endpoints and dumb pipes) в микросервисах.</li>
<li><strong>Как правило, считается анти-паттерном, если используется как <em>основной</em> принцип декомпозиции.</strong> Данные должны следовать за функциональностью или бизнес-возможностью, а не наоборот.</li>
</ul>
</li>
<li>
<p><strong>Пример:</strong></p>
<ul>
<li><code>Сервис Клиентов</code> (управляет только данными клиентов)</li>
<li><code>Сервис Товаров</code> (управляет только данными товаров)</li>
<li><code>Сервис Заказов</code> (управляет только данными заказов)</li>
<li><em>Проблема:</em> Как создать заказ? <code>Сервис Заказов</code> должен будет запросить информацию о клиенте у <code>Сервиса Клиентов</code> и информацию о товарах у <code>Сервиса Товаров</code>, проверить их наличие, затем сохранить заказ. Это требует сложной хореографии или оркестрации вызовов.</li>
</ul>
</li>
</ul>
<h3 id="_5">Сравнение и Рекомендации</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Принцип</th>
<th style="text-align: left;">Основной фокус</th>
<th style="text-align: left;">Стабильность границ</th>
<th style="text-align: left;">Связь с бизнесом</th>
<th style="text-align: left;">Риск зацепления</th>
<th style="text-align: left;">Рекомендация</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Бизнес-возможности</strong></td>
<td style="text-align: left;">Что бизнес делает</td>
<td style="text-align: left;">Высокая</td>
<td style="text-align: left;">Прямая</td>
<td style="text-align: left;">Низкий</td>
<td style="text-align: left;"><strong>Наиболее предпочтительный</strong>, стратегический</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Функциональность/DDD</strong></td>
<td style="text-align: left;">Как система работает</td>
<td style="text-align: left;">Средняя</td>
<td style="text-align: left;">Косвенная/DDD</td>
<td style="text-align: left;">Средний</td>
<td style="text-align: left;">Хорош в сочетании с первым, особенно с DDD</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Данные</strong></td>
<td style="text-align: left;">Структура информации</td>
<td style="text-align: left;">Низкая/Средняя</td>
<td style="text-align: left;">Слабая</td>
<td style="text-align: left;"><strong>Высокий</strong></td>
<td style="text-align: left;"><strong>Не рекомендуется</strong> как основной принцип</td>
</tr>
</tbody>
</table>
<p><strong>Общие рекомендации:</strong></p>
<ol>
<li><strong>Начинайте с бизнес-возможностей:</strong> Это наиболее надежный способ определить стабильные, слабосвязанные и бизнес-ориентированные сервисы.</li>
<li><strong>Используйте DDD:</strong> Методология Domain-Driven Design, особенно концепции поддоменов и ограниченных контекстов, является мощным инструментом для уточнения границ, найденных через анализ бизнес-возможностей или функциональности.</li>
<li><strong>Комбинируйте подходы:</strong> На практике часто используется комбинация. Например, основные сервисы выделяются по бизнес-возможностям, а некоторые вспомогательные – по функциональности (например, сервис уведомлений).</li>
<li><strong>Учитывайте нефункциональные требования:</strong> Требования к масштабируемости, производительности, доступности отдельных частей системы также могут влиять на решение о границах сервисов.</li>
<li><strong>Закон Конвея:</strong> Структура вашей организации будет влиять на архитектуру. Старайтесь формировать команды вокруг бизнес-возможностей или ограниченных контекстов.</li>
<li><strong>Итеративность:</strong> Декомпозиция – это не однократное действие. Будьте готовы пересматривать границы сервисов по мере развития системы и углубления понимания предметной области. Начните с более крупных сервисов и разделяйте их дальше при необходимости.</li>
</ol>
<h2 id="_6">Транзакции и консистентность данных в распределенной системе</h2>
<p>Уважаемые студенты,</p>
<p>Продолжая изучение перехода от монолитной архитектуры к микросервисной, сегодня мы сосредоточимся на одной из наиболее сложных и критически важных проблем, возникающих при таком переходе: управление транзакциями и обеспечение консистентности (согласованности) данных в распределенной системе.</p>
<h3 id="acid">Введение: От ACID в монолите к вызовам распределенных систем</h3>
<p>В традиционной монолитной архитектуре приложение часто работает с единой реляционной базой данных. Это позволяет использовать стандартные механизмы <strong>ACID-транзакций</strong> (Atomicity, Consistency, Isolation, Durability) для обеспечения целостности данных при выполнении бизнес-операций.</p>
<ul>
<li><strong>Атомарность (Atomicity):</strong> Транзакция выполняется либо полностью, либо не выполняется вовсе. Нет промежуточных состояний.</li>
<li><strong>Согласованность (Consistency):</strong> Транзакция переводит систему из одного согласованного состояния в другое. Всегда соблюдаются инварианты данных.</li>
<li><strong>Изоляция (Isolation):</strong> Параллельно выполняющиеся транзакции не должны влиять друг на друга. Результат должен быть таким же, как если бы они выполнялись последовательно.</li>
<li><strong>Долговечность (Durability):</strong> После успешного завершения транзакции ее результаты сохраняются даже в случае сбоев системы.</li>
</ul>
<p>Когда мы разбиваем монолит на микросервисы, каждый сервис обычно инкапсулирует свою собственную базу данных (принцип "Database per Service"). Это делается для обеспечения слабой связанности (loose coupling) и независимости сервисов. Однако бизнес-операция, которая в монолите выполнялась в рамках одной ACID-транзакции, теперь может затрагивать данные, распределенные по нескольким сервисам и их базам данных.</p>
<p><strong>Ключевой проблемой является:</strong> Как обеспечить атомарность и согласованность бизнес-операции, охватывающей несколько микросервисов, без использования единой транзакции?</p>
<h3 id="2pc">Проблема традиционных распределенных транзакций (2PC)</h3>
<p>Существуют протоколы для управления транзакциями, охватывающими несколько ресурсов, например, <strong>двухфазный коммит (Two-Phase Commit, 2PC)</strong>.</p>
<p><strong>Как работает 2PC (упрощенно):</strong>  </p>
<ol>
<li><strong>Фаза 1: Подготовка (Prepare)</strong>  <ul>
<li>Координатор транзакции просит все участвующие сервисы (ресурсы) подготовиться к фиксации изменений (например, записать изменения в лог, но не применять окончательно) и заблокировать соответствующие ресурсы.</li>
<li>Каждый участник отвечает: "готов" (prepared) или "не готов" (aborted).</li>
</ul>
</li>
<li><strong>Фаза 2: Фиксация (Commit) или Откат (Rollback)</strong><ul>
<li>Если <strong>все</strong> участники ответили "готов", координатор отправляет команду "commit" (зафиксировать). Участники фиксируют изменения и освобождают ресурсы.</li>
<li>Если <strong>хотя бы один</strong> участник ответил "не готов" или не ответил (тайм-аут), координатор отправляет команду "rollback" (откатить). Участники отменяют свои изменения и освобождают ресурсы.</li>
</ul>
</li>
</ol>
<p><strong>Недостатки 2PC в контексте микросервисов:</strong></p>
<ol>
<li><strong>Блокировки и доступность:</strong> Во время фазы подготовки ресурсы остаются заблокированными, иногда на длительное время, если один из участников медленно отвечает. Это снижает пропускную способность и доступность системы. Если координатор выходит из строя после фазы подготовки, но до фазы фиксации, ресурсы могут остаться заблокированными на неопределенное время.</li>
<li><strong>Производительность:</strong> Протокол требует синхронного обмена сообщениями между координатором и участниками, что создает значительные задержки (latency).</li>
<li><strong>Временная связанность (Temporal Coupling):</strong> Все участвующие сервисы должны быть доступны одновременно для успешного завершения транзакции. Сбой одного сервиса приводит к откату всей операции. Это противоречит идее независимости и отказоустойчивости микросервисов.</li>
<li><strong>Несовместимость технологий:</strong> Реализация 2PC может быть сложной или невозможной, если сервисы используют разные типы баз данных (SQL, NoSQL), которые не поддерживают этот протокол одинаково.</li>
</ol>
<p>Из-за этих недостатков 2PC редко используется в современных микросервисных архитектурах. Вместо строгой согласованности (strong consistency), обеспечиваемой ACID и 2PC, приходится принимать модель <strong>итоговой согласованности (eventual consistency)</strong>.</p>
<h3 id="eventual-consistency">Итоговая согласованность (Eventual Consistency)</h3>
<ul>
<li><strong>Определение:</strong> Модель согласованности, при которой система гарантирует, что если новые обновления данных прекратятся, то со временем все реплики данных во всех узлах (сервисах) придут к одному и тому же значению. Однако в любой конкретный момент времени разные сервисы могут "видеть" слегка отличающиеся (неактуальные) версии данных.</li>
<li><strong>Принцип:</strong> Вместо атомарного выполнения операции во всех сервисах одновременно, мы выполняем последовательность локальных транзакций в каждом задействованном сервисе. Система достигает согласованного состояния не мгновенно, а по прошествии некоторого времени.</li>
<li><strong>Приемлемость:</strong> Для многих бизнес-процессов (например, размещение заказа, обновление каталога, публикация контента) мгновенная согласованность не является абсолютным требованием. Задержка в несколько секунд или даже минут между обновлением запасов и его отображением в каталоге может быть допустимой.</li>
</ul>
<p>Основной вызов при использовании итоговой согласованности – как управлять бизнес-операциями, которые должны быть атомарными с точки зрения бизнеса, несмотря на отсутствие глобальной транзакции? Для этого используется паттерн <strong>Saga</strong>.</p>
<h3 id="saga">Паттерн Saga</h3>
<ul>
<li><strong>Определение:</strong> Saga – это последовательность локальных транзакций в разных сервисах. Каждая локальная транзакция обновляет данные в пределах одного сервиса и публикует событие (или отправляет команду), которое инициирует следующую локальную транзакцию в другом сервисе.</li>
<li><strong>Обеспечение "атомарности":</strong> Если какая-либо локальная транзакция в последовательности завершается неудачно, Saga должна выполнить <strong>компенсирующие транзакции</strong> для отмены результатов всех предыдущих успешных локальных транзакций в рамках этой Saga. Компенсирующая транзакция – это операция, которая семантически отменяет эффект предыдущей операции (например, возврат средств вместо отмены платежа, отмена бронирования вместо удаления записи о брони).</li>
</ul>
<p><strong>Пример Saga: Размещение заказа</strong></p>
<p>Бизнес-операция: Клиент размещает заказ. Это требует:</p>
<ol>
<li>Создать заказ в <code>Сервисе Заказов</code> (Order Service) в статусе "pending".</li>
<li>Авторизовать платеж в <code>Сервисе Платежей</code> (Payment Service).</li>
<li>Зарезервировать товары на складе в <code>Сервисе Инвентаризации</code> (Inventory Service).</li>
<li>Изменить статус заказа на "approved" в <code>Сервисе Заказов</code>.</li>
</ol>
<p><strong>Последовательность локальных транзакций и компенсирующих действий:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: center;">Шаг</th>
<th style="text-align: left;">Сервис</th>
<th style="text-align: left;">Локальная транзакция</th>
<th style="text-align: left;">Компенсирующая транзакция (при отказе на след. шаге)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Сервис Заказов</td>
<td style="text-align: left;">Создать Заказ (статус <code>pending</code>)</td>
<td style="text-align: left;">Отменить/Удалить Заказ</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">Сервис Платежей</td>
<td style="text-align: left;">Авторизовать Платеж</td>
<td style="text-align: left;">Отменить/Вернуть Платеж</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;">Сервис Инвентаризации</td>
<td style="text-align: left;">Зарезервировать Товар</td>
<td style="text-align: left;">Освободить резерв Товара</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: left;">Сервис Заказов</td>
<td style="text-align: left;">Обновить статус Заказа на <code>approved</code></td>
<td style="text-align: left;">(Обычно откат не нужен, если предыдущие шаги успешны)</td>
</tr>
</tbody>
</table>
<p><strong>Если шаг 3 (Резервирование Товара) завершается неудачно:</strong></p>
<ul>
<li><code>Сервис Инвентаризации</code> инициирует откат.</li>
<li>Выполняется компенсирующая транзакция для шага 2: <code>Сервис Платежей</code> отменяет авторизацию платежа.</li>
<li>Выполняется компенсирующая транзакция для шага 1: <code>Сервис Заказов</code> изменяет статус заказа на "failed" или удаляет его.</li>
</ul>
<p><strong>Способы реализации Sagas:</strong></p>
<ol>
<li>
<p><strong>Хореография (Choreography):</strong></p>
<ul>
<li><strong>Принцип:</strong> Нет центрального координатора. Каждый сервис после выполнения своей локальной транзакции публикует событие в общую шину сообщений (message broker). Другие сервисы подписываются на интересующие их события и реагируют, выполняя свои локальные транзакции и публикуя новые события.</li>
<li><strong>Преимущества:</strong> Слабая связанность (сервисы не знают друг о друге напрямую), простота добавления новых участников.</li>
<li><strong>Недостатки:</strong> Сложно отслеживать и отлаживать общий поток выполнения Saga (логика распределена), риск циклических зависимостей, управление ошибками и компенсацией распределено.</li>
</ul>
</li>
<li>
<p><strong>Оркестрация (Orchestration):</strong></p>
<ul>
<li><strong>Принцип:</strong> Вводится специальный сервис-оркестратор, который управляет выполнением Saga. Оркестратор отправляет команды каждому сервису для выполнения локальной транзакции и ожидает ответа. В зависимости от ответа, он отправляет команду следующему сервису или инициирует компенсирующие транзакции при сбое.</li>
<li><strong>Преимущества:</strong> Централизованная логика управления Saga (легче понимать, отлаживать, изменять), явное управление процессом компенсации.</li>
<li><strong>Недостатки:</strong> Оркестратор может стать узким местом (bottleneck) и единой точкой отказа (single point of failure), сервисы могут стать зависимыми от API оркестратора (риск некоторой связанности).</li>
</ul>
</li>
</ol>
<p>Выбор между хореографией и оркестрацией зависит от сложности бизнес-процесса и требований к управляемости.</p>
<h3 id="_7">Другие важные паттерны и концепции</h3>
<ul>
<li><strong>Transactional Outbox:</strong> Гарантирует, что сообщение/событие будет отправлено <em>после</em> и только <em>после</em> успешного завершения локальной транзакции. Это предотвращает отправку сообщений при откате транзакции или потерю сообщений при сбое после коммита, но до отправки. Реализуется путем записи сообщения в специальную таблицу ("outbox") в той же транзакции, что и основные изменения данных, и последующей асинхронной отправкой сообщений из этой таблицы отдельным процессом.</li>
<li><strong>Idempotent Consumers (Идемпотентные обработчики):</strong> В системах с обменом сообщениями возможна повторная доставка одного и того же сообщения. Обработчики сообщений (например, сервисы, реагирующие на события в Saga) должны быть идемпотентными, то есть повторная обработка одного и того же сообщения не должна приводить к некорректным результатам или побочным эффектам (например, повторное списание средств).</li>
<li><strong>CQRS (Command Query Responsibility Segregation):</strong> Разделение моделей и путей выполнения для команд (изменение состояния) и запросов (чтение данных). Это может помочь в работе с итоговой согласованностью, позволяя иметь оптимизированные для чтения модели данных, которые обновляются асинхронно и могут быть слегка неактуальными.</li>
</ul>
<h3 id="_8">Вызовы и сложности</h3>
<ul>
<li><strong>Сложность проектирования:</strong> Разработка Sagas, компенсирующих транзакций, обеспечение идемпотентности требует значительных усилий и тщательного анализа бизнес-процессов.</li>
<li><strong>Тестирование:</strong> Тестирование распределенных транзакций, особенно сценариев сбоев и компенсаций, значительно сложнее, чем тестирование локальных ACID-транзакций.</li>
<li><strong>Отладка и мониторинг:</strong> Отслеживание выполнения бизнес-операции через несколько сервисов и диагностика проблем требуют развитых инструментов мониторинга и распределенной трассировки.</li>
<li><strong>Пользовательский опыт (UX):</strong> Необходимо продумывать, как информировать пользователя о статусе длительной операции и как обрабатывать ситуации, когда данные временно не согласованы.</li>
</ul>
<h2 id="_9">Проблемы разбиения монолита на микросервисы: Чрезмерная фрагментация и Сложность взаимодействия</h2>
<p>Уважаемые студенты,</p>
<p>На предыдущих лекциях мы обсуждали преимущества микросервисной архитектуры и принципы декомпозиции монолита. Мы говорили о том, как разбиение на независимые сервисы может повысить гибкость разработки, масштабируемость и отказоустойчивость системы. Однако, как и любой архитектурный подход, микросервисы не являются универсальным решением и несут в себе собственные вызовы и потенциальные проблемы. Некорректное или непродуманное разбиение монолита может привести к созданию системы, которая окажется сложнее, дороже в поддержке и менее надежной, чем исходный монолит.</p>
<p>Сегодня мы сосредоточимся на двух взаимосвязанных ключевых проблемах, возникающих при декомпозиции: <strong>чрезмерной фрагментации</strong> и <strong>сложности взаимодействия</strong> между сервисами.</p>
<h3 id="1">1. Чрезмерная фрагментация (Проблема "Наносервисов")</h3>
<p>Стремление к максимальной гранулярности и независимости иногда приводит к созданию слишком большого количества чрезмерно мелких сервисов, часто называемых "наносервисами".</p>
<ul>
<li><strong>Определение:</strong> Чрезмерная фрагментация – это ситуация, когда система разделена на такое большое количество мелких сервисов, что накладные расходы на их управление и взаимодействие перевешивают потенциальные выгоды от декомпозиции. Сервис становится настолько мал, что его функциональность минимальна (например, сервис, отвечающий только за валидацию одного поля или выполнение одной элементарной операции).</li>
<li>
<p><strong>Причины возникновения:</strong></p>
<ul>
<li>Буквальное толкование приставки "микро".</li>
<li>Неверное определение границ сервисов (например, разбиение по техническим слоям или отдельным функциям вместо бизнес-возможностей).</li>
<li>Преждевременная оптимизация или рефакторинг без четкого понимания домена.</li>
<li>Следование "моде" без критического анализа целесообразности.</li>
</ul>
</li>
<li>
<p><strong>Негативные последствия:</strong></p>
<ul>
<li><strong>Экспоненциальный рост операционной сложности:</strong><ul>
<li><strong>Развертывание:</strong> Управление CI/CD пайплайнами для сотен или тысяч сервисов становится чрезвычайно сложным и ресурсоемким.</li>
<li><strong>Мониторинг и логирование:</strong> Требуются сложные распределенные системы трассировки, агрегации логов и мониторинга для отслеживания состояния и производительности множества мелких компонентов.</li>
<li><strong>Инфраструктура:</strong> Потребление ресурсов (память, CPU, сетевые подключения) на поддержание среды выполнения для каждого сервиса может стать значительным.</li>
</ul>
</li>
<li><strong>Деградация производительности:</strong><ul>
<li><strong>Сетевая задержка (Latency):</strong> Выполнение даже простой бизнес-операции может потребовать цепочки вызовов между множеством наносервисов. Каждый сетевой вызов добавляет задержку, суммарное время отклика растет.</li>
<li><strong>Надежность сети:</strong> Увеличивается вероятность сбоев из-за проблем в сети или недоступности одного из множества сервисов.</li>
</ul>
</li>
<li><strong>Сложность разработки и отладки:</strong><ul>
<li>Разработчикам приходится ориентироваться в огромном количестве сервисов и их взаимосвязей.</li>
<li>Отладка запроса, проходящего через десятки сервисов, становится крайне затруднительной.</li>
<li>Понимание общей картины работы системы усложняется.</li>
</ul>
</li>
<li><strong>Сложность рефакторинга и эволюции:</strong> Изменение API или логики, затрагивающее несколько наносервисов, требует координации изменений во многих местах, что замедляет разработку и увеличивает риски.</li>
<li><strong>Риск "распределенного монолита":</strong> Если наносервисы тесно связаны частыми синхронными вызовами, они фактически образуют распределенный монолит – систему с проблемами монолита (сильная связанность), усугубленными проблемами распределенных систем (сетевые задержки, сложность управления).</li>
<li><strong>Чрезмерное усложнение управления транзакциями:</strong> Операции, которые были атомарными в рамках одного сервиса (или монолита), теперь требуют сложных Sagas, охватывающих множество мелких шагов, что увеличивает вероятность ошибок и усложняет логику компенсации.</li>
</ul>
</li>
<li>
<p><strong>Пример:</strong> Вместо одного сервиса <code>Управление Профилем Пользователя</code>, создание отдельных сервисов для <code>ИмениПользователя</code>, <code>EmailПользователя</code>, <code>АдресаПользователя</code>, <code>АватараПользователя</code> явно избыточно и приведет ко всем перечисленным выше проблемам при любом действии с профилем.</p>
</li>
</ul>
<h3 id="2_1">2. Сложность взаимодействия между сервисами</h3>
<p>Эта проблема может возникнуть даже если сервисы имеют разумный размер, но их взаимодействие спроектировано неудачно.</p>
<ul>
<li><strong>Определение:</strong> Сложность взаимодействия – это ситуация, когда коммуникация между сервисами становится запутанной, неэффективной, хрупкой и трудной для понимания, управления и развития.</li>
<li><strong>Проявления и последствия:</strong><ul>
<li><strong>"Болтливые" взаимодействия (Chatty Communication):</strong><ul>
<li><strong>Проблема:</strong> Для выполнения одной бизнес-операции сервисы делают множество мелких синхронных запросов друг к другу (например, сервис A вызывает B, B вызывает C, C возвращает данные B, B обрабатывает и вызывает D, D возвращает B, B возвращает A).</li>
<li><strong>Последствия:</strong> Высокая задержка, низкая отказоустойчивость (сбой одного сервиса в цепочке ломает всю операцию), сильная временная связанность.</li>
</ul>
</li>
<li><strong>Сложные графы зависимостей:</strong><ul>
<li><strong>Проблема:</strong> Сервисы имеют глубокие или широкие деревья зависимостей (один сервис зависит от многих других, или цепочки вызовов очень длинные).</li>
<li><strong>Последствия:</strong> Сложность понимания потоков данных и управления ими, большой радиус поражения при сбое одного сервиса, трудности при тестировании и развертывании (необходимо учитывать все зависимости).</li>
</ul>
</li>
<li><strong>Неявные контракты и сильная связанность:</strong><ul>
<li><strong>Проблема:</strong> Сервисы полагаются на детали реализации друг друга, а не на четко определенные и стабильные API. Изменения в одном сервисе часто требуют изменений в других.</li>
<li><strong>Последствия:</strong> Хрупкость системы, сложность рефакторинга и независимого развития сервисов.</li>
</ul>
</li>
<li><strong>Сложность управления распределенными данными:</strong><ul>
<li><strong>Проблема:</strong> Необходимость поддерживать согласованность данных между сервисами с помощью сложных паттернов (Sagas, CQRS, Event Sourcing), если декомпозиция была проведена без учета транзакционных границ.</li>
<li><strong>Последствия:</strong> Увеличение сложности кода, тестирования и отладки.</li>
</ul>
</li>
<li><strong>Управление версиями API:</strong><ul>
<li><strong>Проблема:</strong> При изменении API сервиса необходимо обеспечить обратную совместимость или скоординировать обновление всех зависимых сервисов.</li>
<li><strong>Последствия:</strong> Замедление темпов разработки, риск нарушения работы системы при некорректном управлении версиями.</li>
</ul>
</li>
<li><strong>Проблемы тестирования:</strong><ul>
<li><strong>Проблема:</strong> Интеграционное тестирование системы из множества взаимодействующих сервисов становится сложным и требует поддержки комплексных тестовых окружений или использования сложных стратегий мокирования/стабов.</li>
<li><strong>Последствия:</strong> Снижение уверенности в корректности работы системы, увеличение времени и стоимости тестирования.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="_10">Стратегии смягчения проблем</h3>
<p>Как избежать ловушек чрезмерной фрагментации и сложности взаимодействия?</p>
<ol>
<li><strong>Начинайте с более крупных границ:</strong> Используйте принципы декомпозиции по <strong>бизнес-возможностям</strong> и <strong>ограниченным контекстам (DDD)</strong>. Это помогает создавать сервисы с высокой внутренней связностью (cohesion) и слабой внешней связанностью (coupling).</li>
<li><strong>Принцип высокой связности (High Cohesion):</strong> Группируйте внутри одного сервиса те части функциональности и данных, которые часто изменяются вместе и тесно связаны логически.</li>
<li><strong>Автономность сервисов:</strong> Проектируйте сервисы так, чтобы они могли выполнять свои основные функции с минимальной зависимостью от других сервисов в реальном времени.</li>
<li><strong>Предпочитайте асинхронное взаимодействие:</strong> Где это возможно и уместно (например, для уведомлений, фоновых процессов), используйте асинхронные паттерны (события, очереди сообщений) вместо синхронных запросов (REST/gRPC). Это снижает временную связанность и повышает отказоустойчивость.</li>
<li><strong>Не бойтесь начать с "микро-монолитов":</strong> Иногда лучше начать с нескольких более крупных, хорошо определенных сервисов, и лишь затем, при необходимости и наличии четких оснований, разделять их дальше. <em>Объединить множество наносервисов гораздо сложнее, чем разделить относительно большой сервис</em>.</li>
<li><strong>Моделируйте и измеряйте:</strong> Используйте инструменты моделирования для визуализации зависимостей. Внедряйте мониторинг для отслеживания метрик взаимодействия (частота вызовов, задержки, ошибки), чтобы выявлять "узкие места" и проблемные зависимости.</li>
<li><strong>Учитывайте структуру команд (Закон Конвея):</strong> Архитектура системы часто отражает структуру коммуникаций в организации. Старайтесь выравнивать границы сервисов с границами команд для повышения автономии и ответственности.</li>
</ol>
<h2 id="_11">Заключение</h2>
<ol>
<li>
<p>Правильная декомпозиция монолита – сложная, но критически важная задача. Выбор стратегии определяет будущую гибкость, масштабируемость и управляемость вашей системы. Подход, основанный на бизнес-возможностях и подкрепленный принципами Domain-Driven Design, как правило, дает наиболее устойчивые и эффективные результаты. Декомпозиция исключительно по данным или чисто технической функциональности без привязки к бизнес-контексту часто приводит к созданию хрупких и сложных в поддержке распределенных систем.</p>
</li>
<li>
<p>Переход к микросервисам означает отказ от удобства глобальных ACID-транзакций в пользу модели итоговой согласованности. Это требует применения новых подходов и паттернов, таких как Saga, для управления бизнес-операциями, охватывающими несколько сервисов. Хотя эти подходы сложнее в реализации и требуют тщательного проектирования, они позволяют создавать масштабируемые, отказоустойчивые и слабосвязанные системы, что является основной целью микросервисной архитектуры. Обеспечение консистентности данных в распределенной среде — это всегда поиск компромисса между согласованностью, доступностью и производительностью, который должен базироваться на конкретных требованиях бизнеса.</p>
</li>
<li>
<p>Разбиение монолита на микросервисы требует глубокого понимания предметной области, тщательного проектирования и готовности к управлению сложностью распределенных систем. Чрезмерная фрагментация и неуправляемая сложность взаимодействия являются серьезными рисками, способными свести на нет все ожидаемые выгоды.<br />
Цель состоит не в том, чтобы создать как можно больше сервисов, а в том, чтобы найти <strong>оптимальный уровень гранулярности</strong>, который обеспечивает нужный баланс между независимостью, гибкостью, производительностью и управляемостью системы. Подход, основанный на бизнес-домене и постоянном анализе компромиссов, является ключом к успешной реализации микросервисной архитектуры.</p>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "search.suggest", "content.tooltips"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>